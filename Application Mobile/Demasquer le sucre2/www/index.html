<!DOCTYPE html>
<html>

<head>
    <!-- Meta tags -->
    <meta charset="utf-8" />
    <meta name="author" content="Noureddine ADJOU" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
	<!-- Debuger -->
	 <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' ; media-src * ; connect-src 'self' http://172.31.7.30/ ">

    <!-- Title -->
    <title>Démasquer le sucre</title>
	
    <!-- Css Styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap-theme.min.css" rel="stylesheet" type="text/css" />
    <!--- -->
	<script type="text/javascript" src="js/jQuery.min.js"></script>
	<script type="text/javascript" src="js/jquery.tmpl.min.js"></script>
	<script type="text/javascript" src="js/jquery.p2r.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
	<script type="text/javascript" src="cordova.js"></script>
	

	
</head>

<!-- Header -->
<div class="page-header container" align="center">
    <h1>Page de connexion</h1>
</div>

<div class="container"  align="center">
        <form method="post" id="form">
            <h3>Adresse mail</h3>
            <input type="text" name="email" id="email" class="form-control" required>
            <h3>Mot de passe</h3>
            <input type="password" name="mdp" id="mdp" class="form-control" required>
            <br><br>
            <input class="btn btn-primary" type="submit" value="Se connecter">
        </form>
</div>

<script>
   
	
    $("#form").submit(function (e) {
		
		localStorage.setItem("flagScan","False");
		localStorage.setItem("sucre","-1");
        var form = $(this);
        var url = form.attr('action');
        $.ajax({
            type: "POST",
            url: 'http://172.31.7.30/api/authentification.php',
            data: form.serialize(), // serializes the form's elements.
            success: function (data) {
                /*Selon data on se redérecte vers l'accueil*/
				
				try
				{
					var obj = JSON.parse(data);
					localStorage.setItem("nom",obj.nom);
					localStorage.setItem("temps",obj.temps);
					window.location.replace("accueil.html")
				}
				catch(e)
				{
					alert("Erreur d'authentification");
					window.location.replace("index.html");
				}
				
				
                //if(data.localeCompare("root1234adj")==0)
            }
        });
        e.preventDefault(); // avoid to execute the actual submit of the form.
    });
</script>
</body>
</html>